<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial for Cb estimation • predtools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial for Cb estimation">
<meta property="og:description" content="predtools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">predtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cb.html">Tutorial for Cb estimation</a>
    </li>
    <li>
      <a href="../articles/mROC.html">howtouse</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/resplab/predtools/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cb_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial for Cb estimation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/resplab/predtools/blob/master/vignettes/cb.Rmd"><code>vignettes/cb.Rmd</code></a></small>
      <div class="hidden name"><code>cb.Rmd</code></div>

    </div>

    
    
<p>This tutotial provides background information and stepwise tutorial for Cb calculations.</p>
<p>###What is Cb?</p>
<p>Consider a risk model that predicts the rate or risk of an outcome (e.g., 5-year mortality due to breast cancer). The risk model estimates the risk / rate of the event given an individual’s characteristics. The discriminatory performance of such a model is often communicated in terms of C-statistic (or area under the curve of the receiver operating characteristic curve).</p>
<p>Sometimes our interest is in using covariates to predict the benefit of treatment (rather than the risk). Cb is a summary metric that quantifies to what extend a model predicts treatment benefit.</p>
<p>The table below compares and contrasts C and Cb statstics.</p>
<table class="table">
<colgroup>
<col width="14%">
<col width="46%">
<col width="38%">
</colgroup>
<thead><tr class="header">
<th align="left">First Header</th>
<th align="center">C-statistic</th>
<th align="left">Cb</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Application</td>
<td align="center">Models for risk</td>
<td align="left">Models for treatment benefit</td>
</tr>
<tr class="even">
<td align="left">Probabilistic interpretation</td>
<td align="center">Randomly select a pair of individuals, one that experiences the outconme and one that does not. C is the probability that the risk model predicts a higher risk for the individual with event</td>
<td align="left">Randomly select a pair of individuals. Consider the two scenarios: A) give treatment to one at random, B) give treatment to the one with the higher predicted benefit. Cb is the relative loss of efficiency of scenario A compared with scenario B</td>
</tr>
<tr class="odd">
<td align="left">Range</td>
<td align="center">[0.5,1]</td>
<td align="left">[0,1]</td>
</tr>
<tr class="even">
<td align="left">Interpretation</td>
<td align="center">The model with higher C is better</td>
<td align="left">The model with higher Cb is better</td>
</tr>
</tbody>
</table>
<p>##Formal definition of Cb</p>
<p>Let b be the benefit of treatment on the decision scale (e.g., the absolute risk reduction with treatment). Often times, this benefit is estimated from a risk model. Let Y be the outcome of interest, X the set of covariates, and A the treatment indicator. A risk model can be used to predict treatment benefit in this circumstance we can develop a model directly predicting treatment benefit:</p>
<p><span class="math display">\[b=E(Y|X,A=1)-E(Y|X,A=0)\]</span></p>
<p>Cb is a threshold-free index that describes to what extent covariates X can discriminate among individuals who will differently benefit from treatment, given their covariates.</p>
<p>If B1, B2, and B3 are random draws from the distribution of b (as defined in the above equation), then</p>
<p><span class="math display">\[C_b=1-E(B_1)/E(max(B_2,B_3))\]</span></p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("remotes")</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"resplab/predtools"</span><span class="op">)</span></code></pre></div>
<p>##How the package works</p>
<p>The package provides simple functions for calculating Cb for different regression models.</p>
<p>###Direct calculation of Cb when the vector of benefits are available. Cb.simple() is for such an estimation method.</p>
<p>In the example below, we simply create vector B of randomly generated numbers.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/resplab/predtools">predtools</a></span><span class="op">)</span>
<span class="va">B</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>
<span class="va">res</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/Cb.simple.html">Cb.simple</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></code></pre></div>
<pre><code>## Cb= 0.2606379 
## e_b= 0.4924628 
## e_max_b1b2= 0.6660645 
## Gini= 0.3525173 
## AUCi= 0.6762587 
## Data length: 100</code></pre>
<p>In effect, this function equals to creating all possible pairs within the vector B, and estimating the maximum within each pair.</p>
<p>###Cb calculations for different regression frameworks</p>
<p>The package comes with functions that help you calculate Cb for different type of regression models. These function accept a fitted regression object and a few extra parameters and calculate Cb.</p>
<p>Let’s focus on a more realistic example. The package comes with a simulated randomized clinical trial (RCT) data, named rct_data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"rct_data"</span><span class="op">)</span></code></pre></div>
<p>Let’s take a look at the first few rows:</p>
<table class="table">
<thead><tr class="header">
<th align="right">tx</th>
<th align="right">female</th>
<th align="right">age</th>
<th align="right">prev_hosp</th>
<th align="right">prev_ster</th>
<th align="right">fev1</th>
<th align="right">sgrq</th>
<th align="right">time</th>
<th align="right">tte</th>
<th align="right">n_exac</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">60.04992</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.125416</td>
<td align="right">0.6208415</td>
<td align="right">0.7562069</td>
<td align="right">NA</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">74.32678</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1.230864</td>
<td align="right">0.5971572</td>
<td align="right">0.9685049</td>
<td align="right">NA</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">69.02729</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.892702</td>
<td align="right">0.2350660</td>
<td align="right">0.9969646</td>
<td align="right">0.0738847</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">62.51775</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.070905</td>
<td align="right">0.4851237</td>
<td align="right">0.9341948</td>
<td align="right">NA</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">72.98540</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1.559421</td>
<td align="right">0.0838917</td>
<td align="right">1.0000000</td>
<td align="right">NA</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">70.31170</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1.140794</td>
<td align="right">0.5489664</td>
<td align="right">0.8978731</td>
<td align="right">0.1335712</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">63.56974</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.384113</td>
<td align="right">0.6934356</td>
<td align="right">1.0000000</td>
<td align="right">0.9150555</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>This is a hypothetical RCT of two treatments for Chronic Obstructive Pulmonary Disease (COPD). COPD is a chronic disease that comes with episodes of intensified activity, called exacerbations. The benefit of treatment is in reducing the rate of such exacerbations.</p>
<p>The columns are as follows.</p>
<table class="table">
<colgroup>
<col width="22%">
<col width="15%">
<col width="61%">
</colgroup>
<thead><tr class="header">
<th align="left">Variable</th>
<th align="center">Type</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">tx</td>
<td align="center">binary</td>
<td align="left">Treatment assignment variable (0: placebo, 1: treatment)</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="center">binary</td>
<td align="left">1 for female and 0 for male</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="center">continuous</td>
<td align="left">Age in years at time of randomization</td>
</tr>
<tr class="even">
<td align="left">prev_hosp</td>
<td align="center">binary</td>
<td align="left">History of COPD-related hospitalization in the previous 12 months</td>
</tr>
<tr class="odd">
<td align="left">prev_ster</td>
<td align="center">binary</td>
<td align="left">History of COPD-related hospitalization in the previous 12 months</td>
</tr>
<tr class="even">
<td align="left">fev1</td>
<td align="center">continuous</td>
<td align="left">Forced expiratory volume at one second, a measure of lung capacity</td>
</tr>
<tr class="odd">
<td align="left">sgrq</td>
<td align="center">continuous</td>
<td align="left">St. George Respiratory Questionnaire score</td>
</tr>
<tr class="even">
<td align="left">time</td>
<td align="center">continuous</td>
<td align="left">Total follow-up time in years (maximum 1 year)</td>
</tr>
<tr class="odd">
<td align="left">tte</td>
<td align="center">continuous</td>
<td align="left">Time to first exacerbation in years (NA if no exacerbation)</td>
</tr>
<tr class="even">
<td align="left">n_exac</td>
<td align="center">discrete</td>
<td align="left">Total number of exacerbations during follow-up</td>
</tr>
</tbody>
</table>
<p>####Logistic regression Imagine we want to evaluate the predictability of treatment benefit in terms of reducing 6-month exacerbation risk. Because in the RCT, everyone is followed for at least 6 month, there is no censoring for this outcome, and logistic regression is a valid framework for inference. We first create a binary variable indicating whether an exacerbation occurred within the first 6 months.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rct_data</span><span class="op">[</span>,<span class="st">'b_exac'</span><span class="op">]</span><span class="op">&lt;-</span><span class="va">rct_data</span><span class="op">[</span>,<span class="st">'tte'</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0.5</span>
<span class="va">rct_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">rct_data</span><span class="op">[</span>,<span class="st">'b_exac'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,<span class="st">'b_exac'</span><span class="op">]</span><span class="op">&lt;-</span><span class="cn">FALSE</span></code></pre></div>
<p>Now lets fit the regression</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reg.logostic</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">b_exac</span> <span class="op">~</span> <span class="va">tx</span> <span class="op">+</span> <span class="va">sgrq</span> <span class="op">+</span> <span class="va">prev_hosp</span> <span class="op">+</span> <span class="va">prev_ster</span> <span class="op">+</span> <span class="va">fev1</span>, data <span class="op">=</span> <span class="va">rct_data</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">reg.logostic</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:  glm(formula = b_exac ~ tx + sgrq + prev_hosp + prev_ster + fev1, 
##     family = binomial(link = "logit"), data = rct_data)
## 
## Coefficients:
## (Intercept)           tx         sgrq    prev_hosp    prev_ster         fev1  
##    -1.45847     -0.37696      0.47688      0.35028     -0.05079      0.15754  
## 
## Degrees of Freedom: 1107 Total (i.e. Null);  1102 Residual
## Null Deviance:       1255 
## Residual Deviance: 1238  AIC: 1250</code></pre>
<p>Now we call the Cb.logistic function. This function has two mandatory parameters: the glm object containing the logit model, and a text variable indicating the name of treatment variable.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res.logistic</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/Cb.logistic.html">Cb.logistic</a></span><span class="op">(</span><span class="va">reg.logostic</span>,tx_var <span class="op">=</span> <span class="st">"tx"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">res.logistic</span><span class="op">)</span></code></pre></div>
<pre><code>## Cb= 0.05618547 
## e_b= 0.07045515 
## e_max_b1b2= 0.07464936 
## Gini= 0.0595302 
## AUCi= 0.5297651 
## Data length: 1108</code></pre>
<p>The main output is Cb.</p>
<p>Cb.logistic (and similar functions) calculate Cb parametrically. The package includes semi-parametric methods for Cb calculation as well. To use the semi-parametric method, we simply set the value of optimal parameter semi_parametric to TRUE.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res.logistic.NP</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/Cb.logistic.html">Cb.logistic</a></span><span class="op">(</span><span class="va">reg.logostic</span>,tx_var <span class="op">=</span> <span class="st">"tx"</span>,semi_parametric <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">res.logistic.NP</span><span class="op">)</span></code></pre></div>
<pre><code>## Cb= 0.3548675 
## e_b= 0.07137062 
## e_max_b1b2= 0.1106294 
## Gini= NA 
## AUCi= NA 
## Data length: 1108</code></pre>
<p>#####What happens under the hood?</p>
<p>Cb.logistic() and other functions estimate the outcome for each subject in the data under treatment and no treatment scenarios, and then calculate the vector b as the difference, then they call the Cb.simple() function.</p>
<p>Below we do this manually.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_data0</span><span class="op">&lt;-</span><span class="va">rct_data</span>
<span class="va">new_data0</span><span class="op">[</span>,<span class="st">'tx'</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">0</span>
<span class="va">new_data1</span><span class="op">&lt;-</span><span class="va">rct_data</span>
<span class="va">new_data1</span><span class="op">[</span>,<span class="st">'tx'</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">1</span>
<span class="va">B</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.glm.html">predict.glm</a></span><span class="op">(</span><span class="va">reg.logostic</span>, newdata<span class="op">=</span><span class="va">new_data0</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.glm.html">predict.glm</a></span><span class="op">(</span><span class="va">reg.logostic</span>, newdata <span class="op">=</span><span class="va">new_data1</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/Cb.simple.html">Cb.simple</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Cb= 0.05618547 
## e_b= 0.07045515 
## e_max_b1b2= 0.07464936 
## Gini= 0.0595302 
## AUCi= 0.5297651 
## Data length: 1108</code></pre>
<p>###Cb.poisson() for count models</p>
<p>Cb.poisson() calculates Cb from count models (Poisson and negative binomial). Note that unlie the logistic model, here follow-up time is relevant too. Cb.poission() by default estimates Cb at one unit of time.</p>
<p>Our plan for the trial data is to fit a model that associates predictor to the number of exacerbations during the follow-up time.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reg.poisson</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">n_exac</span> <span class="op">~</span> <span class="va">tx</span> <span class="op">+</span> <span class="va">tx</span><span class="op">:</span><span class="va">sgrq</span> <span class="op">+</span> <span class="va">prev_hosp</span> <span class="op">+</span> <span class="va">prev_ster</span> <span class="op">+</span> <span class="va">fev1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">rct_data</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">reg.poisson</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:  glm(formula = n_exac ~ tx + tx:sgrq + prev_hosp + prev_ster + 
##     fev1 + offset(log(time)), family = poisson(link = "log"), 
##     data = rct_data)
## 
## Coefficients:
## (Intercept)           tx    prev_hosp    prev_ster         fev1      tx:sgrq  
##   -0.737413    -0.603839     0.372331    -0.036207     0.003777     0.513799  
## 
## Degrees of Freedom: 1107 Total (i.e. Null);  1102 Residual
## Null Deviance:       1118 
## Residual Deviance: 1083  AIC: 1985</code></pre>
<p>Once the regression object is fitted, we call Cb.poisson() passing the regression object and the name of the treatment variable.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res.poisson</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/Cb.poisson.html">Cb.poisson</a></span><span class="op">(</span><span class="va">reg.poisson</span>,tx_var <span class="op">=</span> <span class="st">"tx"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">res.poisson</span><span class="op">)</span></code></pre></div>
<pre><code>## Cb= 0.1287493 
## e_b= 0.1660044 
## e_max_b1b2= 0.1905358 
## Gini= 0.1477752 
## AUCi= 0.5738876 
## Data length: 1108</code></pre>
<p>Again, the Cb.poission() function estimates the difference in counterfactual outcomes for each patient, and calls Cb.simple(). Not that to do this manually in this context, we need to set the follow-up time for each subject to 1.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_data0</span><span class="op">&lt;-</span><span class="va">rct_data</span>
<span class="va">new_data0</span><span class="op">[</span>,<span class="st">'tx'</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">0</span>
<span class="va">new_data0</span><span class="op">[</span>,<span class="st">'time'</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">1</span>
<span class="va">new_data1</span><span class="op">&lt;-</span><span class="va">rct_data</span>
<span class="va">new_data1</span><span class="op">[</span>,<span class="st">'tx'</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">1</span>
<span class="va">new_data1</span><span class="op">[</span>,<span class="st">'time'</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">1</span>
<span class="va">B</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.glm.html">predict.glm</a></span><span class="op">(</span><span class="va">reg.poisson</span>, newdata<span class="op">=</span><span class="va">new_data0</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.glm.html">predict.glm</a></span><span class="op">(</span><span class="va">reg.poisson</span>, newdata <span class="op">=</span><span class="va">new_data1</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/Cb.simple.html">Cb.simple</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Cb= 0.1287493 
## e_b= 0.1660044 
## e_max_b1b2= 0.1905358 
## Gini= 0.1477752 
## AUCi= 0.5738876 
## Data length: 1108</code></pre>
<p>###Cb.cox() for Cox proportional hazard model</p>
<p>Cb.cox() estimates Cb from a proportional hazards model. Like Cb.poission(), the length of time matters in the value of Cb, and Cb.cox() estimates Cb at one unit of time.</p>
<p>Our plan for the trial data is to estimate the effect of covariates on redicting time to the first event. txBenefit is compatible with the Cox proportional hazard model implemented in the survial package.</p>
<p>We create an event indicator and update the tte (time-to-event) variable to be equal to follpow-up time for censored individuals.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/therneau/survival">"survival"</a></span><span class="op">)</span>
 <span class="va">event</span><span class="op">&lt;-</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">rct_data</span><span class="op">[</span>,<span class="st">'tte'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">1</span>
 <span class="va">ids</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">event</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span>
 <span class="va">rct_data</span><span class="op">[</span><span class="va">ids</span>,<span class="st">'tte'</span><span class="op">]</span><span class="op">&lt;-</span><span class="va">rct_data</span><span class="op">[</span><span class="va">ids</span>,<span class="st">'time'</span><span class="op">]</span>
 <span class="va">rct_data</span><span class="op">[</span><span class="st">'event'</span><span class="op">]</span><span class="op">&lt;-</span><span class="va">event</span></code></pre></div>
<p>Now we fit the Cox model calling the coxph() function. However, AN IMPORTANT DIFFERENCE is that the object that coxph() by default does not contain the original data (unlike glm()), which is needed for the calculations. As such, we have to call coxph() with an additional argument model=TRUE.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reg.coxph</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span>time<span class="op">=</span><span class="va">tte</span>,event<span class="op">=</span><span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">tx</span> <span class="op">+</span> <span class="va">tx</span><span class="op">:</span><span class="va">female</span> <span class="op">+</span> <span class="va">tx</span><span class="op">:</span><span class="va">age</span> <span class="op">+</span> <span class="va">sgrq</span> <span class="op">+</span> <span class="va">prev_hosp</span> <span class="op">+</span> <span class="va">prev_ster</span> <span class="op">+</span> <span class="va">fev1</span>, data<span class="op">=</span><span class="va">rct_data</span>, model<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">reg.coxph</span><span class="op">)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(time = tte, event = event) ~ tx + tx:female + 
##     tx:age + sgrq + prev_hosp + prev_ster + fev1, data = rct_data, 
##     model = TRUE)
## 
##                coef exp(coef)  se(coef)      z        p
## tx         0.255575  1.291204  0.544894  0.469 0.639044
## sgrq       0.490846  1.633698  0.315023  1.558 0.119203
## prev_hosp  0.379077  1.460936  0.104630  3.623 0.000291
## prev_ster -0.122554  0.884658  0.144538 -0.848 0.396491
## fev1      -0.000233  0.999767  0.102541 -0.002 0.998187
## tx:female  0.017177  1.017325  0.151408  0.113 0.909675
## tx:age    -0.009026  0.991015  0.008315 -1.085 0.277733
## 
## Likelihood ratio test=29.06  on 7 df, p=0.0001412
## n= 1108, number of events= 413</code></pre>
<p>Once this is done, we call the related Cb function:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">res.coxph</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/Cb.cox.html">Cb.cox</a></span><span class="op">(</span><span class="va">reg.coxph</span>,tx_var <span class="op">=</span> <span class="st">"tx"</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></code></pre></div>
<pre><code>## Cb= 0.2606379 
## e_b= 0.4924628 
## e_max_b1b2= 0.6660645 
## Gini= 0.3525173 
## AUCi= 0.6762587 
## Data length: 100</code></pre>
<p>Important note: Cb cannot currently be calculated for Cox models that have time-dependent covariates, nor for the models with strata.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mohsen Sadatsafavi, Amin Adibi, Abdollah Safari.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
